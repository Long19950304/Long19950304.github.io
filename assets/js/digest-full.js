(()=>{if(!document.querySelector(".digest-page"))return;const e=e=>(e||"").toString().trim(),t=t=>e(t).toLowerCase(),a=t=>{const a=/^(\d{4})-(\d{2})-(\d{2})\s+(\d{2}):(\d{2})\s+UTC$/.exec(e(t));if(!a)return 0;const[r,o,n,l,c,s]=a;return Date.UTC(+o,+n-1,+l,+c,+s)},r=async e=>{try{return await navigator.clipboard.writeText(e),!0}catch{try{const t=document.createElement("textarea");return t.value=e,t.style.position="fixed",t.style.left="-9999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),!0}catch{return!1}}},o=o=>{const n=o.querySelector("[data-digest-full-list]");if(!n)return;const l=Array.from(o.querySelectorAll(".digest-full-item")),c=o.querySelector("[data-digest-full-search]"),s=o.querySelector("[data-digest-full-sort]"),d=o.querySelector('[data-digest-full-filter="category"]'),u=o.querySelector('[data-digest-full-filter="source"]'),i=(document.documentElement.getAttribute("lang")||"en").toLowerCase().startsWith("zh"),y=i?"\u5168\u90e8":"All",m=i?"\u7c7b\u522b":"Category",p=i?"\u6765\u6e90":"Source",g=t=>t?e(t.value):"",f=(e,t,a)=>{if(!e)return;const r=e.value;e.innerHTML="";const o=document.createElement("option");o.value="all",o.textContent=`${t}: ${y}`,e.appendChild(o),a.forEach(t=>{const a=document.createElement("option");a.value=t,a.textContent=t,e.appendChild(a)}),r&&Array.from(e.options).some(e=>e.value===r)?e.value=r:e.value="all"},C=e=>{const t=Array.from(new Set(e.filter(Boolean)));return t.sort((e,t)=>e.localeCompare(t)),t},h=C(l.map(t=>e(t.dataset.category))),v=C(l.map(t=>e(t.dataset.source)));f(d,m,h),f(u,p,v);const E=()=>{const a=t(c?c.value:""),r=g(d),o=g(u);l.forEach(n=>{const l=t(n.dataset.title),c=t(n.dataset.url),s=e(n.dataset.category),d=e(n.dataset.source),u=!a||l.includes(a)||c.includes(a),i=!r||"all"===r||s===r,y=!o||"all"===o||d===o;n.style.display=u&&i&&y?"":"none"})},x=()=>{const t=g(s)||"time",r=l.filter(e=>"none"!==e.style.display);r.sort((r,o)=>"source"===t?e(r.dataset.source).localeCompare(e(o.dataset.source)):"category"===t?e(r.dataset.category).localeCompare(e(o.dataset.category)):a(o.dataset.published)-a(r.dataset.published)),r.forEach(e=>n.appendChild(e))},S=()=>{E(),x()};c&&c.addEventListener("input",S),s&&s.addEventListener("change",S),d&&d.addEventListener("change",S),u&&u.addEventListener("change",S),o.addEventListener("click",async e=>{const t=e.target&&e.target.closest?e.target.closest(".digest-copy-row"):null;if(!t)return;const a=t.getAttribute("data-copy-url")||"",o=t.getAttribute("data-copy-title")||"",n=o?`${o} \u2014 ${a}`:a;if(!await r(n))return;const l=t.textContent;t.textContent=i?"\u5df2\u590d\u5236":"Copied",setTimeout(()=>t.textContent=l,900)}),S()};document.querySelectorAll("[data-digest-full]").forEach(o)})();
(()=>{const t=(document.documentElement.getAttribute("lang")||"en").toLowerCase(),e=(e,n)=>t.startsWith("zh")?n:e,n=t=>{document.querySelectorAll("details.cite-share[open]").forEach(e=>{const n=e.getAttribute("data-cite-share-key")||"";t&&n===t||e.removeAttribute("open")})},o=async t=>{const e=String(t??"");try{return await navigator.clipboard.writeText(e),!0}catch{try{const t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="fixed",t.style.top="-1000px",t.style.left="-1000px",document.body.appendChild(t),t.select();const n=document.execCommand("copy");return document.body.removeChild(t),n}catch{return!1}}},i=(t,e,n)=>{const o=new Blob([String(e??"")],{type:n||"text/plain;charset=utf-8"}),i=URL.createObjectURL(o),r=document.createElement("a");r.href=i,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)},r=t=>String(t??"").replace(/\r\n/g,"\n").trim()+"\n",a=t=>String(t??"").replace(/\r\n/g,"\n").trim()+"\n",c=t=>JSON.stringify(t??{},null,2).replace(/\r\n/g,"\n").trim()+"\n",s=t=>{const e=t.querySelector("script.cite-share__data");if(!e)return null;try{return JSON.parse(e.textContent||"{}")}catch{return null}},d=(t,e)=>{const n=t.querySelector("summary.cite-share__summary");if(!n)return;const o=n.textContent;n.textContent=e,window.setTimeout(()=>{n.textContent=o},1100)},l=t=>{const l=s(t);l&&(t.addEventListener("toggle",()=>{const e=t.getAttribute("data-cite-share-key")||"";t.open&&n(e)}),t.addEventListener("click",async n=>{const s=n.target;if(!(s instanceof HTMLElement))return;const u=s.getAttribute("data-cite-share-action");if(!u)return;n.preventDefault(),n.stopPropagation();const p=l.key||"citation",y=l.canonical_url||l.url||"",m=l.citation_plain||"",f=r(l.bibtex||""),h=a(l.ris||""),b=c(l.csl_json||{}),g=[m,y].filter(Boolean).join("\n");if("copy_link"===u){const n=await o(y);return void d(t,n?e("Link copied","\u5df2\u590d\u5236\u94fe\u63a5"):e("Copy failed","\u590d\u5236\u5931\u8d25"))}if("copy_citation"===u){const n=await o(m);return void d(t,n?e("Citation copied","\u5df2\u590d\u5236\u5f15\u7528"):e("Copy failed","\u590d\u5236\u5931\u8d25"))}if("copy_bibtex"===u){const n=await o(f);return void d(t,n?e("BibTeX copied","\u5df2\u590d\u5236 BibTeX"):e("Copy failed","\u590d\u5236\u5931\u8d25"))}if("copy_ris"===u){const n=await o(h);return void d(t,n?e("RIS copied","\u5df2\u590d\u5236 RIS"):e("Copy failed","\u590d\u5236\u5931\u8d25"))}if("copy_csl_json"===u){const n=await o(b);return void d(t,n?e("CSL-JSON copied","\u5df2\u590d\u5236 CSL-JSON"):e("Copy failed","\u590d\u5236\u5931\u8d25"))}if("copy_share_text"===u){const n=await o(g);return void d(t,n?e("Share text copied","\u5df2\u590d\u5236\u5206\u4eab\u6587\u6848"):e("Copy failed","\u590d\u5236\u5931\u8d25"))}return"download_bibtex"===u?(i(`${p}.bib`,f,"application/x-bibtex;charset=utf-8"),void d(t,e("Downloading\u2026","\u6b63\u5728\u4e0b\u8f7d\u2026"))):"download_ris"===u?(i(`${p}.ris`,h,"application/x-research-info-systems;charset=utf-8"),void d(t,e("Downloading\u2026","\u6b63\u5728\u4e0b\u8f7d\u2026"))):"download_csl_json"===u?(i(`${p}.csl.json`,b,"application/vnd.citationstyles.csl+json;charset=utf-8"),void d(t,e("Downloading\u2026","\u6b63\u5728\u4e0b\u8f7d\u2026"))):void 0}))},u=()=>{document.querySelectorAll("details.cite-share").forEach(l)};document.addEventListener("click",t=>{const e=t.target;e instanceof Element&&e.closest("details.cite-share")||n()}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u,{once:!0}):u()})();
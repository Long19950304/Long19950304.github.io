(()=>{const t=t=>{document.querySelectorAll("details.cite-share[open]").forEach(e=>{const n=e.getAttribute("data-cite-share-key")||"";t&&n===t||e.removeAttribute("open")})},e=async t=>{const e=String(t??"");try{return await navigator.clipboard.writeText(e),!0}catch{try{const t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="fixed",t.style.top="-1000px",t.style.left="-1000px",document.body.appendChild(t),t.select();const n=document.execCommand("copy");return document.body.removeChild(t),n}catch{return!1}}},n=(t,e,n)=>{const o=new Blob([String(e??"")],{type:n||"text/plain;charset=utf-8"}),i=URL.createObjectURL(o),r=document.createElement("a");r.href=i,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)},o=t=>String(t??"").replace(/\r\n/g,"\n").trim()+"\n",i=t=>String(t??"").replace(/\r\n/g,"\n").trim()+"\n",r=t=>JSON.stringify(t??{},null,2).replace(/\r\n/g,"\n").trim()+"\n",a=t=>{const e=t.querySelector("script.cite-share__data");if(!e)return null;try{return JSON.parse(e.textContent||"{}")}catch{return null}},c=(t,e)=>{const n=t.querySelector("summary.cite-share__summary");if(!n)return;const o=n.textContent;n.textContent=e,window.setTimeout(()=>{n.textContent=o},1100)},d=d=>{const s=a(d);s&&(d.addEventListener("toggle",()=>{const e=d.getAttribute("data-cite-share-key")||"";d.open&&t(e)}),d.addEventListener("click",async t=>{const a=t.target;if(!(a instanceof HTMLElement))return;const l=a.getAttribute("data-cite-share-action");if(!l)return;t.preventDefault(),t.stopPropagation();const u=s.key||"citation",p=s.canonical_url||s.url||"",y=s.citation_plain||"",f=o(s.bibtex||""),m=i(s.ris||""),h=r(s.csl_json||{}),b=[y,p].filter(Boolean).join("\n");if("copy_link"===l){const t=await e(p);return void c(d,t?"Link copied":"Copy failed")}if("copy_citation"===l){const t=await e(y);return void c(d,t?"Citation copied":"Copy failed")}if("copy_bibtex"===l){const t=await e(f);return void c(d,t?"BibTeX copied":"Copy failed")}if("copy_ris"===l){const t=await e(m);return void c(d,t?"RIS copied":"Copy failed")}if("copy_csl_json"===l){const t=await e(h);return void c(d,t?"CSL-JSON copied":"Copy failed")}if("copy_share_text"===l){const t=await e(b);return void c(d,t?"Share text copied":"Copy failed")}return"download_bibtex"===l?(n(`${u}.bib`,f,"application/x-bibtex;charset=utf-8"),void c(d,"Downloading\u2026")):"download_ris"===l?(n(`${u}.ris`,m,"application/x-research-info-systems;charset=utf-8"),void c(d,"Downloading\u2026")):"download_csl_json"===l?(n(`${u}.csl.json`,h,"application/vnd.citationstyles.csl+json;charset=utf-8"),void c(d,"Downloading\u2026")):void 0}))},s=()=>{document.querySelectorAll("details.cite-share").forEach(d)};document.addEventListener("click",e=>{const n=e.target;n instanceof Element&&n.closest("details.cite-share")||t()}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",s,{once:!0}):s()})();
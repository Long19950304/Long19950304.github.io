(()=>{const e=document.querySelector("[data-digest-index]");if(!e)return;const t=e.querySelector("[data-digest-search]"),s=e.querySelector("[data-digest-results]"),a=e.querySelector("[data-digest-grid]"),n=Array.from(e.querySelectorAll("[data-digest-filter]")),d=Array.from(e.querySelectorAll("[data-digest-card]"));let c="all",i=null,l="";const r=e=>(e||"").toLowerCase().trim(),o="zh"===document.documentElement.lang||window.location.pathname.startsWith("/zh/"),u=e=>e.closest("[data-digest-col]")||e.parentElement||e,h=e=>{const t=r(e),s=new Set;return t?(t.includes("ai tools")&&s.add("ai-tools"),(t.includes("css")||t.includes("society"))&&s.add("ai-society"),t.includes("health")&&s.add("health"),t.includes("education")&&s.add("education"),(t.includes("security")||t.includes("cyber"))&&s.add("security"),(t.includes("business")||t.includes("economy")||t.includes("finance"))&&s.add("business"),t.includes("tech")&&s.add("tech"),s):s},g=()=>(i||(i=fetch("/assets/digest-items.json",{cache:"force-cache"}).then(e=>e.ok?e.json():[]).catch(()=>[])),i),m=async e=>{if(!s)return;l=e;const t=await g();if(l!==e)return;const a=[];for(const s of t){const t=h(s.category),n="all"===c||t.has(c),d=r(`${s.title||""} ${s.title_zh||""} ${s.source||""} ${s.category||""} ${s.date||""}`);if(n&&d.includes(e)&&a.push({it:s,tags:t}),a.length>=30)break}if(!e)return s.hidden=!0,void(s.innerHTML="");s.hidden=!1,s.innerHTML="";const n=document.createElement("div");if(n.className="digest-search-results__header",n.textContent=o?`\u641c\u7d22\u7ed3\u679c\uff1a${a.length} \u6761\uff08\u70b9\u51fb\u6807\u9898\u6253\u5f00\u539f\u6587\uff09`:`Results: ${a.length} items (click title to open source)`,s.appendChild(n),0===a.length){const e=document.createElement("div");return e.className="digest-search-results__empty",e.textContent=o?"\u6682\u65e0\u5339\u914d\u7ed3\u679c\u3002":"No matches.",void s.appendChild(e)}const d=document.createElement("div");d.className="digest-search-results__list";for(const{it:e,tags:t}of a){const t=document.createElement("div");t.className="digest-search-results__item";const s=o&&e.title_zh?e.title_zh:e.title,a=document.createElement("a");a.className="digest-search-results__title",a.href=e.url||e.digest_url||"#",a.target="_blank",a.rel="noopener noreferrer",a.textContent=s||(o?"(\u65e0\u6807\u9898)":"(untitled)");const n=document.createElement("div");n.className="digest-search-results__meta";const c=[];e.date&&c.push(e.date),e.source&&c.push(e.source),e.category&&c.push(e.category),n.textContent=c.join(" \xb7 ");const i=document.createElement("div");i.className="digest-search-results__actions";const l=document.createElement("span");l.className="digest-search-results__badge",l.textContent="ai-tools"===e.kind?o?"AI \u5de5\u5177":"AI tools":o?"\u65b0\u95fb":"News",i.appendChild(l);const r=document.createElement("a");r.className="digest-search-results__link",r.href=o?e.digest_zh_url:e.digest_url,r.textContent=o?"\u8fdb\u5165\u7b80\u62a5":"Open digest",i.appendChild(r),t.appendChild(a),t.appendChild(n),t.appendChild(i),d.appendChild(t)}s.appendChild(d)},p=e=>{c=e,n.forEach(t=>{t.classList.toggle("active",t.dataset.digestFilter===e),t.setAttribute("aria-pressed",t.dataset.digestFilter===e?"true":"false")}),_()},_=()=>{const e=r(t?t.value:"");if(s&&a){const t=e.length>=2;if(s.hidden=!t,a.style.display=t?"none":"",t)return void m(e);s.innerHTML=""}d.forEach(t=>{const s=r(t.dataset.tags||""),a=r(t.dataset.title||""),n=r(t.dataset.tagline||""),d="all"===c||s.split(/\s+/).includes(c),i=!e||(a.includes(e)||n.includes(e)||s.includes(e));u(t).style.display=d&&i?"":"none"})};t&&t.addEventListener("input",_),n.forEach(e=>{e.addEventListener("click",()=>p(e.dataset.digestFilter||"all"))}),p("all")})();